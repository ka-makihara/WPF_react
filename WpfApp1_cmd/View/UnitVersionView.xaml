<UserControl x:Class="WpfApp1_cmd.View.UnitVersionView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:local="clr-namespace:WpfApp1_cmd.View"
             xmlns:vm="clr-namespace:WpfApp1_cmd.ViewModel"
             xmlns:vc="clr-namespace:WpfApp1_cmd.ValueConverter"
             xmlns:core="clr-namespace:WpfApp1_cmd.Core"
             xmlns:models="clr-namespace:WpfApp1_cmd.Models"
             d:DataContext="{d:DesignInstance vm:UnitVersionViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="440" d:DesignWidth="800">

    <UserControl.Resources>
        <ResourceDictionary>
            <Style BasedOn="{StaticResource MahApps.Styles.MetroHeader}" TargetType="{x:Type mah:MetroHeader}">
                <Setter Property="HeaderTemplate">
                    <Setter.Value>
                        <DataTemplate>
                            <StackPanel Orientation="Vertical" UseLayoutRounding="True">
                                <TextBlock Margin="0 4" Text="{Binding}" />
                                <Separator />
                            </StackPanel>
                        </DataTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <ControlTemplate x:Key="ConfigDataTemplate">
                <ControlTemplate.Resources>
                    <Style BasedOn="{StaticResource MahApps.Styles.CheckBox.Win10}" TargetType="{x:Type CheckBox}">
                        <Setter Property="HorizontalAlignment" Value="Stretch" />
                        <Setter Property="MinHeight" Value="0" />
                        <Setter Property="MinWidth" Value="0" />
                    </Style>
                </ControlTemplate.Resources>
            </ControlTemplate>
            <vc:AlbumPriceIsTooMuchConverter x:Key="AlbumPriceIsTooMuchConverter" />
            <core:BindingProxy x:Key="proxy" Data="{Binding}" />
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>

        <!-- 意味不明だが必要　-->
        <FrameworkElement x:Name="DataContextProxy" DataContext="{Binding}" />
        
        <mah:MetroHeader mah:HeaderedControlHelper.HeaderFontSize="22" Header="UniitVersions">
            <mah:MetroHeader.HeaderTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Vertical" UseLayoutRounding="True">
                        <Grid>
                            <TextBlock Margin="0,4" HorizontalAlignment="Left" VerticalAlignment="Bottom" Text="UnitVersions" />
                        </Grid>
                        <Separator />
                    </StackPanel>
                </DataTemplate>
            </mah:MetroHeader.HeaderTemplate>

            <DataGrid x:Name="MetroDataGrid" Margin="5" AutoGenerateColumns="False"
                      EnableColumnVirtualization="True" EnableRowVirtualization="True"
                      HeadersVisibility="All"
                      ItemsSource="{Binding UpdateInfos}"
                      RowHeaderWidth="2"
                      CanUserAddRows="False"
                      SelectionUnit="FullRow"
                      SelectionMode="Extended"
                      GridLinesVisibility="All"
                      VirtualizingPanel.IsVirtualizingWhenGrouping="True">
                <mah:DataGridHelper.AutoGeneratedComboBoxColumnEditingStyle>
                    <Style BasedOn="{StaticResource MahApps.Styles.ComboBox.DataGrid.Editing}" TargetType="{x:Type ComboBox}">
                        <Setter Property="mah:TextBoxHelper.ClearTextButton" Value="True" />
                    </Style>
                </mah:DataGridHelper.AutoGeneratedComboBoxColumnEditingStyle>

                <DataGrid.GroupStyle>
                <!--
                    <GroupStyle>
                        <GroupStyle.ContainerStyle>
                            <Style TargetType="{x:Type GroupItem}">
                                <Setter Property="Margin" Value="0,0,0,5"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type GroupItem}">
                                            <Expander IsExpanded="True" Background="#FF112255" BorderBrush="#FF002255" Foreground="#FFEEEEEE" BorderThickness="1,1,1,5">
                                                <Expander.Header>
                                                    <DockPanel>
                                                        <TextBlock FontWeight="Bold" Text="{Binding Path=Name.Name}" Margin="5,0,0,0" Width="100"/>
                                                        <TextBlock FontWeight="Bold" Text="{Binding Path=ItemCount}"/>
                                                    </DockPanel>
                                                </Expander.Header>
                                                <Expander.Content>
                                                    <ItemsPresenter />
                                                </Expander.Content>
                                            </Expander>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </GroupStyle.ContainerStyle>
                    </GroupStyle>
-->
                    <GroupStyle ContainerStyle="{StaticResource MahApps.Styles.GroupItem.DataGrid}" >
                        <GroupStyle.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox  IsChecked="{Binding DataContext.IsSelectedGroup, Source={x:Reference DataContextProxy}}" Click="CheckBox_Click">
                                        <CheckBox.Style>
                                            <Style BasedOn="{StaticResource MahApps.Styles.CheckBox.Win10}" TargetType="{x:Type CheckBox}">
                                                <Setter Property="HorizontalAlignment" Value="Stretch" />
                                                <Setter Property="MinHeight" Value="0" />
                                                <Setter Property="MinWidth" Value="0" />
                                            </Style>
                                        </CheckBox.Style>
                                    </CheckBox>
                                    <TextBlock VerticalAlignment="Center">
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0} - {1}">
                                                <Binding Path="Name" />
                                                <Binding Path="ItemCount" Converter="{vc:ItemCountConverter}"/>
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </StackPanel>
                            </DataTemplate>
                        </GroupStyle.HeaderTemplate>
                    </GroupStyle>

                </DataGrid.GroupStyle>
                
                <DataGrid.Columns>
                    <!--
                    <DataGridCheckBoxColumn Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=IsSelected, Mode=OneWay}"
                                            Header="Update"
                                            IsReadOnly="True" />
                     -->
                     <!--
                    <DataGridCheckBoxColumn Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                        EditingElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnEditingStyle}"
                                        ElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnStyle}"
                                        >
                     -->
                    <DataGridTemplateColumn>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource MaterialDesignCheckBox}"
                                          IsEnabled="True"
                                          Visibility="{Binding IsVisibled, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <!--
                        <DataGridCheckBoxColumn.Header>
                            <Border Background="Transparent">
                                <CheckBox Content="All" IsChecked="{Binding DataContext.IsAllSelected, Source={x:Reference DataContextProxy}}" />
                            </Border> 
                        </DataGridCheckBoxColumn.Header>
                        <DataGridCheckBoxColumn.HeaderStyle>
                           <Style TargetType="{x:Type DataGridColumnHeader}" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}" >
                                <Setter Property="HorizontalContentAlignment" Value="Center" />
                            </Style> 
                        </DataGridCheckBoxColumn.HeaderStyle>
                    </DataGridCheckBoxColumn>
                    -->
                    <!--
                    <DataGridCheckBoxColumn Binding="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            EditingElementStyle="{DynamicResource MahApps.Styles.CheckBox.DataGrid.Win10}"
                                            Header="Album Selected" />
                    -->
                    <!--
                    <DataGridTextColumn mah:VisibilityHelper.IsVisible="{Binding Source={StaticResource proxy}, Path=Data.ShowTitleColumn}"
                                        Binding="{Binding Title}"
                                        Header="Unit" />
                     -->
                    <DataGridTextColumn Binding="{Binding Name}"    Header="Unit" />
                    <DataGridTextColumn Binding="{Binding Version}" Header="Version" Width="150"/>
                    <!--
                    <DataGridTextColumn Binding="{Binding Version}" Header="UpdateVersion" Width="150"/>
                    -->
                    <!--
                    <DataGridComboBoxColumn DisplayMemberPath="Name"
                                            Header="UdateVersion" Width="150"
                                            ItemsSource="{x:Static models:SampleData.Artists}"
                                            SelectedItemBinding="{Binding Artist}" />
                     -->
                    <!--
                    <DataGridTextColumn Binding="{Binding Genre.Name}" Header="Genre" />
                    <mah:DataGridNumericUpDownColumn Binding="{Binding Price}"
                                                     Header="Price"
                                                     Minimum="0"
                                                     StringFormat="{}{0:C}" />
                    -->
                </DataGrid.Columns>
                <DataGrid.Style>
                    <Style BasedOn="{StaticResource MahApps.Styles.DataGrid}" TargetType="{x:Type DataGrid}" >
                        <Setter Property="AlternatingRowBackground" Value="{DynamicResource MahApps.Brushes.Gray10}" />
                    </Style>
                </DataGrid.Style>
                <!--
                <DataGrid.RowStyle>
                    <Style BasedOn="{StaticResource MahApps.Styles.DataGridRow}" TargetType="{x:Type DataGridRow}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Price, Mode=OneWay, Converter={StaticResource AlbumPriceIsTooMuchConverter}}" Value="True">
                                <Setter Property="Background" Value="#FF8B8B" />
                                <Setter Property="Foreground" Value="DarkRed" />
                            </DataTrigger>

                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Price, Mode=OneWay, Converter={StaticResource AlbumPriceIsTooMuchConverter}}" Value="True" />
                                    <Condition Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource Self}}" Value="true" />
                                </MultiDataTrigger.Conditions>
                                <Setter Property="Background" Value="#FFBDBD" />
                            </MultiDataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
                -->
                <!--
                <DataGrid.RowValidationRules>
                    <vc:AlbumPriceIsReallyTooMuchValidation ValidatesOnTargetUpdated="True" ValidationStep="CommittedValue" />
                    <vc:AlbumPriceIsReallyTooMuchValidation ValidatesOnTargetUpdated="True" ValidationStep="UpdatedValue" />
                </DataGrid.RowValidationRules>
                -->
            </DataGrid>
        </mah:MetroHeader>
    </Grid>
</UserControl>
